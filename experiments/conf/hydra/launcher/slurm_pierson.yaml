defaults:
  - override hydra/launcher: submitit_slurm

hydra:
  launcher:
    _target_: hydra_plugins.hydra_submitit_launcher.submitit_launcher.SlurmLauncher
    submitit_folder: ${hydra.sweep.dir}/.submitit/%j
    timeout_min: 480
    nodes: 1
    tasks_per_node: 1
    cpus_per_task: ${resources.num_cpus}
    mem_gb: 64
    gpus_per_node: ${resources.num_gpus}
    partition: pierson
    array_parallelism: 1
    name: ${hydra.job.name}
    additional_parameters:
      gres: gpu:${resources.num_gpus}
      wckey: ""
    setup:
      - export HYDRA_FULL_ERROR=1
      - source ~/.bashrc
      - export VLLM_WORKER_MULTIPROC_METHOD=spawn
      - export VLLM_USE_V1=1
      - export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:64,expandable_segments:True
      - export CUDA_LAUNCH_BLOCKING=0


